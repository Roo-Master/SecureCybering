<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peer Registration & Login</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f7fa;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }
    .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        width: 300px;
        text-align: center;
    }
    h2 { color: #2563eb; margin-bottom: 15px; }
    input { width: 100%; padding: 8px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
    button { width: 100%; padding: 10px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #1e40af; }
    .toggle { margin-top: 10px; cursor: pointer; color: #2563eb; font-size: 14px; }
    .error { color: red; font-size: 13px; margin-top: 5px; }
    .hidden { display: none; }
</style>
</head>
<body>

<div class="container">
    <!-- Registration Form -->
    <div id="registerForm">
        <h2>Register</h2>
        <input type="text" id="regUsername" placeholder="Username">
        <input type="password" id="regPassword" placeholder="Password">
        <input type="password" id="regConfirmPassword" placeholder="Confirm Password">
        <button id="registerBtn">Register</button>
        <div class="error" id="regError"></div>
        <div class="toggle" id="toLogin">Already have an account? Login</div>
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="hidden">
        <h2>Login</h2>
        <input type="text" id="loginUsername" placeholder="Username">
        <input type="password" id="loginPassword" placeholder="Password">
        <button id="loginBtn">Login</button>
        <div class="error" id="loginError"></div>
        <div class="toggle" id="toRegister">Don't have an account? Register</div>
    </div>
</div>

<script>
let users = JSON.parse(localStorage.getItem('peers') || '{}');

// Form toggle
document.getElementById('toLogin').addEventListener('click', () => {
    document.getElementById('registerForm').classList.add('hidden');
    document.getElementById('loginForm').classList.remove('hidden');
});
document.getElementById('toRegister').addEventListener('click', () => {
    document.getElementById('loginForm').classList.add('hidden');
    document.getElementById('registerForm').classList.remove('hidden');
});

// Registration
document.getElementById('registerBtn').addEventListener('click', () => {
    const username = document.getElementById('regUsername').value.trim();
    const password = document.getElementById('regPassword').value.trim();
    const confirm = document.getElementById('regConfirmPassword').value.trim();
    const error = document.getElementById('regError');
    error.textContent = '';

    if (!username || !password || !confirm) { error.textContent = 'All fields required'; return; }
    if (password !== confirm) { error.textContent = 'Passwords do not match'; return; }
    if (users[username]) { error.textContent = 'Username exists'; return; }

    users[username] = { password };
    localStorage.setItem('peers', JSON.stringify(users));
    alert('Registration successful! Login now.');
    document.getElementById('regUsername').value = '';
    document.getElementById('regPassword').value = '';
    document.getElementById('regConfirmPassword').value = '';
    document.getElementById('registerForm').classList.add('hidden');
    document.getElementById('loginForm').classList.remove('hidden');
});
// intergrator.js (or any JS file you include in your login page)

// Get currently logged-in user from localStorage
const username = localStorage.getItem('username');

// Get peers list from localStorage (default to empty object)
let peers = JSON.parse(localStorage.getItem('peers') || '{}');

// Function to send new user to detector.html for authentication
function sendToDetector(user) {
    // Store user info in localStorage for detector.html to read
    localStorage.setItem('detectorUser', JSON.stringify(user));

    // Redirect to detector.html
    window.location.href = 'detector.html';
}

// Check if user exists in peers
if (username) {
    if (!peers[username]) {
        // User not found in peers, prepare user info
        const userInfo = {
            username: username,
            timestamp: new Date().toISOString()
        };
        console.log('User not in peers, sending to detector.html:', userInfo);

        // Send to detector page for authentication
        sendToDetector(userInfo);
    } else {
        console.log('User exists in peers:', username);
    }
} else {
    console.log('No user logged in');
}


// Login
document.getElementById('loginBtn').addEventListener('click', () => {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    const error = document.getElementById('loginError');
    error.textContent = '';

    if (!username || !password) { error.textContent = 'All fields required'; return; }

    const user = users[username];
    if (!user || user.password !== password) { error.textContent = 'Invalid credentials'; return; }

    localStorage.setItem('username', username);
    alert(`Welcome, ${username}!`);
    window.location.href = 'fraud_gosip.html';
});

</script>

</body>
</html>
